# [ í”„ë¡œì íŠ¸ ê°œìš” ]

### ëª©í‘œ
- ì›¹ ì‚¬ì´íŠ¸ì˜ ê¸°ë³¸ì´ ë˜ëŠ” í•µì‹¬ ê¸°ëŠ¥ë“¤ì„ ì§ì ‘ êµ¬í˜„í•˜ê³ , AWSë¥¼ í†µí•´ ë°°í¬í•˜ëŠ” ê²½í—˜ ìŒ“ê¸°

### êµ¬í˜„í•œ ê¸°ëŠ¥
1. íšŒì›ê°€ì… ë° ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
  - Bcryptë¥¼ í™œìš©í•œ ìœ ì € ì •ë³´ ì•”í˜¸í™”
  - JavaMailSenderë¥¼ í™œìš©í•œ ì¸ì¦ë©”ì¼ ë³´ë‚´ê¸°

2. ê²Œì‹œíŒ 
  - ê²Œì‹œíŒ CRUD
  - ëŒ“ê¸€ CRUD
  - ì œëª©, ì‘ì„±, ì œëª©, ì „ì²´ ì˜µì…˜ìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥
  - ê²Œì‹œê¸€ ë° ëŒ“ê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë° ì¹´ìš´íŒ…

3. íŒŒì¼ ì²¨ë¶€ ë° ë‹¤ìš´ë¡œë“œ
  - ê²Œì‹œê¸€ ì‘ì„±ì‹œ í•œ ê²Œì‹œê¸€ë‹¹ ìµœëŒ€ 3ê°œ íŒŒì¼ ì²¨ë¶€ ê°€ëŠ¥
  - íŒŒì¼ ê°œë³„ ë‹¤ìš´ë¡œë“œ ë° ì „ì²´ zip ë‹¤ìš´ë¡œë“œ, ë‹¤ìš´ë¡œë“œ ìˆ˜ ì¹´ìš´íŒ…

4. WebSocketì„ í™œìš©í•œ ëŒ“ê¸€ ì•Œë¦¼
  - ë‚´ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ì— íƒ€ì¸ì´ ëŒ“ê¸€ì„ ë‹¬ë©´, ìƒë‹¨ì— 5ì´ˆê°„ ì•Œë¦¼ ë„ìš°ê¸°

5. STOMPë¥¼ í™œìš©í•œ ì±„íŒ…ë°© êµ¬í˜„
  - STOMPì˜ í•µì‹¬ ê°œë… (êµ¬ë…ê³¼ ë°œí–‰)ì„ ì´í•´í•˜ê³ , 
   ì±„íŒ…ë°©ì— ì…ì¥/ ëŒ€í™”/ í‡´ì¥ ë©”ì‹œì§€ë¥¼ ë Œë”ë§í•˜ê¸°

### ê°œë°œê¸°ê°„
  - 24.04.11 ~ í˜„ì¬ ë¦¬íŒ©í† ë§ ë° ê¸°ëŠ¥ ì¶”ê°€ ì§„í–‰ ì¤‘

----------------

# [ í”„ë¡œì íŠ¸ ì„¤ëª… ]

### ê¸°ìˆ ìŠ¤íƒ
- Backend  
: `SpringFramework 5.3` `Maven` `MyBatis` `JUnit5`
- Frontend  
: `HTML` `CSS` `JavaScript` `JQuery` `JSP` `Tiles`
- Database  
: `MySQL 8.0`
- Deploy  
: `Apache Tomcat` `AWS(EC2, RDS)`  `Nginx`  `MobaXterm`  `FileZilla`
- Else  
: `Git` `Sourctree` `GitHub`  `Notion`

### ì•„í‚¤í…ì²˜
<img width="223" alt="architecture" src="https://github.com/pickylemon/2024-portfolio-2nd/assets/156510800/a10867e3-cdb2-41d7-b2b9-a7ec2ebc78b9">

----------------

# [ êµ¬í˜„ ê¸°ëŠ¥ ìƒì„¸ ]

**[ë…¸ì…˜ìœ¼ë¡œ ì´ë™](https://pacific-soil-139.notion.site/1d2d062cb6ed41d0a3e0efc66cab4cbf?pvs=4)**

**[Github issue ëª¨ìŒ](https://github.com/pickylemon/2024-portfolio-2nd/issues?q=is%3Aissue+is%3Aclosed)**  

## 1. íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
### - íšŒì›ê°€ì…
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/3)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/auth/controller/JoinController.java)**

### - ë¡œê·¸ì¸
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/5)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/auth/controller/LoginController.java)**

### - ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/7)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/auth/service/AuthCommonService.java)**

## 2. ê²Œì‹œíŒ CRUD, ê²€ìƒ‰, ëŒ“ê¸€CRUD, ì¢‹ì•„ìš”/ì‹«ì–´ìš”

### - ê²Œì‹œíŒ CRUD, í˜ì´ì§•, ê²€ìƒ‰
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/10)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/forum/notice/controller/NoticeController.java)**

### -ì¢‹ì•„ìš”/ì‹«ì–´ìš”
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/21)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/forum/notice/service/BoardService.java)**

### - ëŒ“ê¸€
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/19)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/forum/notice/controller/RestCommentController.java)**

## 3. íŒŒì¼ ì—…ë¡œë“œ / ë‹¤ìš´ë¡œë“œ

### - íŒŒì¼ ì—…ë¡œë“œ
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/17)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/forum/notice/util/FileUtil.java)**

### - ê°œë³„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ / ì „ì²´ íŒŒì¼ zip ë‹¤ìš´ë¡œë“œ
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/17)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/forum/notice/util/FileDownloadView.java)**



## 4. ëŒ“ê¸€ ì•Œë¦¼ê³¼ ì±„íŒ… êµ¬í˜„ (WebSocketê³¼ STOMP í™œìš©)

### - ìˆœìˆ˜ WebSocketì„ í†µí•œ ëŒ“ê¸€ ì•Œë¦¼ êµ¬í˜„
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/30)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/alarm/WebSocketHandler.java)**

### - STOMPë¥¼ í†µí•œ ì±„íŒ…ë°© êµ¬í˜„
**[ê´€ë ¨ Github issueë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/issues/38)**  
**[ê´€ë ¨ ì½”ë“œë¡œ ì´ë™](https://github.com/pickylemon/2024-portfolio-2nd/blob/develop/src/main/java/com/portfolio/www/chat/controller/ChatController.java)**

----------------

# [ë¬¸ì œ í•´ê²° ì‚¬ë¡€]

### 1. zip íŒŒì¼ë¡œ ì „ì²´ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
#### [ìƒí™©]
- ê²Œì‹œê¸€ì— ì²¨ë¶€ëœ íŒŒì¼ì´ 2ê°œ ì´ìƒì¼ ê²½ìš°, zip íŒŒì¼ë¡œ í•œë²ˆì— ë‹¤ìš´ ë°›ëŠ” ì˜µì…˜ì´ ìˆë‹¤.
- ê¸°ì¡´ zipíŒŒì¼ì„ ë§Œë“œëŠ” ë©”ì„œë“œì—ì„œëŠ” Fileíƒ€ì…ì˜ Listë¥¼ ì¸ìë¡œ ë°›ê³  ìˆëŠ”ë°,
Fileê°ì²´ë¡œë¶€í„°ëŠ” ì„œë²„ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ì €ì¥ëœ íŒŒì¼ëª…ë§Œ ì–»ì„ ìˆ˜ ìˆë‹¤.
- ì„œë²„ì— ì €ì¥ë˜ëŠ” íŒŒì¼ë“¤ì€, ê°ê° êµ¬ë¶„ë  ìˆ˜ ìˆë„ë¡ UUIDë¥¼ ë³€í˜•í•œ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥ëœë‹¤.
- ì¦‰,  í•´ë‹¹ ì½”ë“œë¡œëŠ” 
ìœ ì €ê°€ zipíŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ì„œ ì••ì¶•ì„ í•´ì œì‹œ, ì—…ë¡œë“œì‹œì˜ ì›ë³¸ íŒŒì¼ëª…ì„ ì–»ì„ ìˆ˜ ì—†ë‹¤.
```java
//before
@Component
public class FileUtil {
.. (ì¤‘ëµ)

	//ê¸°ì¡´ ì½”ë“œëŠ” Fileíƒ€ì…ì˜ ê°ì²´ë¥¼ ìë£Œêµ¬ì¡°ì— ë‹´ì•„ ë°›ê³  ìˆëŠ”ë°,
	//Fileê°ì²´ì—ì„œëŠ” getName()ìœ¼ë¡œ ë¬¼ë¦¬ì ìœ¼ë¡œ ì €ì¥ëœ(UUIDì˜ ë³€í˜•) ì´ë¦„ë§Œ êµ¬í•  ìˆ˜ ìˆë‹¤.
	/
	public File makeCompressedFile(List<File> zipList) {
	...(ì¤‘ëµ)
	
		for(CustomFile file : zipList) {
				fis = new FileInputStream(file);
				ZipEntry zipEntry = new ZipEntry(file.getName()); 
				//ì••ì¶•í•´ì œì‹œ ì—…ë¡œë“œì‹œì˜ ì›ë³¸ íŒŒì¼ëª…ì´ ì•„ë‹Œ, UUID í˜•íƒœì˜ ì´ë¦„ì˜ íŒŒì¼ëª…ì´ ë‚˜íƒ€ë‚¨.
				
				zos.putNextEntry(zipEntry);
				
				 byte[] bytes = new byte[1024];
              int length;
              while((length = fis.read(bytes)) != -1) {
                  zos.write(bytes, 0, length);
              }

              fis.close();
              zos.closeEntry();
			}
	}
}
```

#### [í•´ê²°]
- File í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” CustomFile í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ê³  orgFileNmì„ í•„ë“œì— ì¶”ê°€í–ˆë‹¤.
```java
/**
 * íŒŒì¼ ë‹¤ìš´ë¡œë“œì‹œ, 
 * abstractPathë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œ fileNameì´ ì•„ë‹Œ
 * ì—…ë¡œë“œ ì‹œì˜ ì›ë³¸ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì“°ê³  ì‹¶ì–´ì„œ ë§Œë“  í´ë˜ìŠ¤
 */
@Getter
public class CustomFile extends File {
	
	private File file;
	private String orgFileNm;
	
	public CustomFile(String abstractPath, String orgFileNm) {
		super(abstractPath);
		this.orgFileNm = orgFileNm;
	}
}
```

#### [ê²°ê³¼]
- FileUtilí´ë˜ìŠ¤ì˜ zipíŒŒì¼ì„ ë§Œë“œëŠ” ë©”ì„œë“œì—ì„œ Fileíƒ€ì…ì´ ì•„ë‹Œ CutomFile íƒ€ì…ì˜ Listë¥¼ ì¸ìë¡œ ë°›ìŒìœ¼ë¡œì¨, zipíŒŒì¼ ìƒì„±ì‹œ ì›ë³¸ íŒŒì¼ëª…ì„ ì‚´ë¦´ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
```java
//after
@Component
public class FileUtil {
.. (ì¤‘ëµ)

	//CustomFileíƒ€ì…ì˜ Listë¥¼ ë°›ìŒìœ¼ë¡œì¨, ì—…ë¡œë“œì‹œì˜ ì›ë³¸ íŒŒì¼ëª…ì„ ì•Œ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
	public File makeCompressedFile(List<CustomFile> zipList) {
	...(ì¤‘ëµ)
	
		for(CustomFile file : zipList) {
				fis = new FileInputStream(file);
				ZipEntry zipEntry = new ZipEntry(file.getOrgFileNm()); 
				//ì••ì¶•í•´ì œì‹œ ì—…ë¡œë“œì‹œì˜ ì›ë³¸ íŒŒì¼ëª…ì„ ì–»ì„ ìˆ˜ ìˆê²Œ ë¨.
				
				zos.putNextEntry(zipEntry);
				
				 byte[] bytes = new byte[1024];
              int length;
              while((length = fis.read(bytes)) != -1) {
                  zos.write(bytes, 0, length);
              }

              fis.close();
              zos.closeEntry();
		}
	}
}
```
-------------------------

### 2. ë¯¼ê°í•œ ì„¤ì •íŒŒì¼ ì•”í˜¸í™”í•˜ê¸°
#### [ìƒí™©]
- DBë‚˜ JavaMailSender ê´€ë ¨ ì„¤ì •ë“¤ì€ ê°œì¸ì •ë³´ê°€ ì½”ë“œì— ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ê²Œ ëœë‹¤.
- .gitignoreë¡œ í•´ë‹¹ íŒŒì¼ë“¤ì„ ê¹ƒìœ¼ë¡œ ê´€ë¦¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ, 
 waríŒŒì¼ ë°°í¬ì‹œ í•´ë‹¹ íŒŒì¼ë“¤ì˜ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš°ë„ ìˆìœ¼ë¯€ë¡œ (Jenkinsë¥¼ í†µí•œ ë°°í¬ ë“±)
 ë‹¨ìˆœíˆ ì„¤ì • íŒŒì¼ì„ ì˜¬ë¦¬ì§€ ì•ŠëŠ” ê²ƒì´ í•´ê²°ì±…ì´ ë  ìˆ˜ê°€ ì—†ì—ˆë‹¤.
```java
// before : ê°œì¸ì •ë³´ê°€ ê·¸ëŒ€ë¡œ ì½”ë“œì— ë…¸ì¶œë˜ì–´ ìˆëŠ” ìƒí™©

// database ê´€ë ¨ ì„¤ì •
	<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName" value="com.mysql.cj.jdbc.Driver" />
		<property name="url" value="jdbc:mysql://localhost:73306/board?serverTimezone=Asia/Seoul" />
		<property name="username" value="admin"/>
		<property name="password" value="admin"/>
	</bean>


// JavaMailSender ê´€ë ¨ ì„¤ì •
	<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
		<property name="host" value="smtp.naver.com" />
		<property name="port" value="587" />
		<property name="username" value="ë©”ì¼ì£¼ì†Œ" />
		<property name="password" value="ë¹„ë°€ë²ˆí˜¸" />
		<property name="javaMailProperties">
			<props>
				<prop key="mail.smtp.starttls.enable">true</prop>
			</props>
		</property>
	</bean>
```

#### [í•´ê²°]
- Jasypt ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ì„¤ì • ì •ë³´ë¥¼ ì•”í˜¸í™”í–ˆë‹¤.   
   **>>>> ğŸ’¡ [Jasypt ë¼ì´ë¸ŒëŸ¬ë¦¬ ì •ë¦¬(ë¸”ë¡œê·¸ ì •ë¦¬)](http://velog.io/@melodie104/Jasyptë¥¼-ì´ìš©í•œ-ì„¤ì •-ì •ë³´-ì•”í˜¸í™”)**

- ë¡œì»¬ì—ì„œ í™˜ê²½ë³€ìˆ˜ì— ì„¤ì •ì„ í•´ì£¼ì—ˆìœ¼ë¯€ë¡œ, ì›ê²©ìœ¼ë¡œ ë°°í¬ì‹œì—ë„ ë˜‘ê°™ì´ í™˜ê²½ë³€ìˆ˜ë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.  
  **>>>>ğŸ’¡ [ì›ê²© í†°ìº£ì˜ Jasypt í™˜ê²½ë³€ìˆ˜ ì„¤ì •(ë¸”ë¡œê·¸ ì •ë¦¬)](http://velog.io/@melodie104/ë°°í¬-2.-ìˆ˜ë™-ë°°í¬)**

- Jasypt ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì„¤ì •ì •ë³´ë¥¼ ì•”í˜¸í™”í•˜ê³  ë¡œì»¬ í™˜ê²½ê³¼ ë°°í¬ í™˜ê²½(ê°œë°œ)ì—ì„œ
ì„¤ì •íŒŒì¼ì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨ ë³´ë‹¤ ìœ ìš©í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆì—ˆë‹¤.
- ë¯¼ê°í•œ ì •ë³´ë“¤ì„ ì•”í˜¸í™”í•¨ìœ¼ë¡œì¨ íŒŒì¼ì´ ë…¸ì¶œë˜ì–´ë„ ì•ˆì „ì„ ë³´ì¥ë°›ì„ ìˆ˜ ìˆë‹¤.
- ì•”í˜¸í™” keyë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì§ì ‘ ë“±ë¡í•˜ëŠ” ë°©ì‹ì„ íƒí•¨ìœ¼ë¡œì¨, keyë¥¼ ë…¸ì¶œì‹œí‚¤ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
```java
<!-- db-config.properties -->

db.url=ENC(rlBEtizIYH0bJ1iclJfaIyimpCfLYhKeYGRg6cLPS7DcZ0OJIrjzJMQk7/e/ZHlJYbb135Z)
db.username=ENC(Lmt45==DQWERhhQZDIoNan2KY=)
db.password=ENC(c3Fk0/Yh5dqN83fsD91xoQWERZ/0qpSI7)
```
------------------------------

### 3. ë¡œê·¸ì¸ í•„í„° êµ¬í˜„
#### [ìƒí™©]
- ê²Œì‹œíŒì´ë‚˜ ì±„íŒ…ì°½ ë“± ë¡œê·¸ì¸ íšŒì›ë§Œ ì´ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ì˜ ê²½ìš°,  
ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ í•´ë‹¹ í˜ì´ì§€ì— ì ‘ê·¼í•  ê²½ìš°, ë¡œê·¸ì¸ ìƒíƒœë¥¼ íŒë³„í•´ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¨¼ì € ìœ ë„í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•˜ë‹¤.
- ì´ì²˜ëŸ¼ ê³µí†µ ë¡œì§ì´ ì—¬ëŸ¬ êµ°ë°ì—ì„œ ì¤‘ë³µë˜ëŠ” í˜„ìƒì´ ìˆì—ˆëŠ”ë° ì´ëŠ” ìœ ì§€ ë³´ìˆ˜ ê´€ì ì—ì„œë„ ì¢‹ì§€ ì•Šê³  ê°ì²´ì§€í–¥ì ì¸ ì½”ë“œê°€ ì•„ë‹ˆì–´ì„œ ê°œì„ ì´ í•„ìš”í–ˆë‹¤.
```java
//before
@Controller
@RequestMapping("/forum/notice")
@RequiredArgsConstructor
public class NoticeController {

	public String listPage(HttpServletRequest request, ...) {
			HttpSession session = request.getSession(false);
			if(session == null || session.getAttribute("memberSeq") {
					return "redirect:/auth/loginPage.do";
			}
	(ì¤‘ëµ)
	}
}
```

#### [í•´ê²°]
- ê³µí†µ ë¡œì§ì„ LoginFilterë¡œ ë”°ë¡œ ë¶„ë¦¬í•´ì„œ ê°ì²´ì§€í–¥ì ìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.
- ë˜í•œ  í•´ë‹¹ Filterë¥¼ ì ìš©í•  ê²½ë¡œë¥¼ LoginFilterì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ enumìœ¼ë¡œ ê´€ë¦¬í•¨ìœ¼ë¡œì¨
ì½”ë“œì˜ ì‘ì§‘ë„ë¥¼ ë†’ì´ê³ ì í–ˆë‹¤.
- ë˜í•œ ë¡œê·¸ì¸ í›„ì—ëŠ” ì›ë˜ ì ‘ê·¼í•˜ê³ ì í–ˆë˜ í˜ì´ì§€ë¡œ ë‹¤ì‹œ redirectë¥¼ ì‹œí‚´ìœ¼ë¡œì¨ ì‚¬ìš©ì í¸ì˜ë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆì—ˆë‹¤. 
(ex. ë¹„ ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ê²Œì‹œíŒ ì ‘ê·¼ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ â†’ ë¡œê·¸ì¸ ì„±ê³µ í›„ ë‹¤ì‹œ ê²Œì‹œíŒìœ¼ë¡œ redirect)

```java
public class LoginFilter implements Filter {
//í•„í„°
	private List<String> urlMappings = LoginUrlMapping.getUrlList();

	@Override
	public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain)
			throws IOException, ServletException {
		HttpServletRequest request = (HttpServletRequest)req;
		HttpServletResponse response = (HttpServletResponse)resp;
		String contextPath = request.getContextPath();
		String requestURL = request.getRequestURL().toString();
		String requestURI = request.getRequestURI().replaceAll(contextPath, "");
		HttpSession session = request.getSession(false);
		
		//ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì¸ì§€ ê²€ì‚¬
		if(urlMappings.stream().anyMatch(url -> requestURI.startsWith(url))) {
			log.info("ë¡œê·¸ì¸ í•„í„° ì‹œì‘");
			//ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì¼ë•Œ ë¡œê·¸ì¸ ìƒíƒœì¸ì§€ ê²€ì‚¬
			if(session == null || ObjectUtils.isEmpty(session.getAttribute("memberSeq"))) {
				response.sendRedirect(contextPath+"/auth/loginPage.do?url="+requestURL);
				return;  //returnì´ ë§¤ìš° ì¤‘ìš”. return ì•ˆ í•´ì£¼ë©´ chain.doFilterê¹Œì§€ ì‹¤í–‰ë¨.
			}
		}
		chain.doFilter(request, response);
	}
	
	
	//LoginFilterê°€ ì ìš©í•  ê²½ë¡œë“¤ì€ ë‚´ë¶€ì ìœ¼ë¡œ enumìœ¼ë¡œ ë”°ë¡œ ê´€ë¦¬
	@Getter
	private enum LoginUrlMapping {
		BOARD("/forum"),
		SALES("/sales"),
		QA("/qa"),
		SUPPORT("/support"),
		CHAT("/chat");
		
		private final String url;
		
		LoginUrlMapping(String url) {
			this.url = url;
		}
		
		private static List<String> getUrlList() {
			return Stream.of(LoginUrlMapping.values())
					.map(LoginUrlMapping::getUrl)
					.collect(Collectors.toList());
		}
	}
}
```
----------------------------

### 4. EC2 í™˜ê²½ì—ì„œ WebSocket Connection ì—ëŸ¬ í•´ê²°í•˜ê¸°
#### [ìƒí™©]
- ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ì˜ ìƒì„±ë˜ë˜ WebSocket Connectionì´
waríŒŒì¼ì„ ì›ê²© ì„œë²„ì— ì˜¬ë¦¬ì ì—°ê²°ë˜ì§€ ì•ŠëŠ” í˜„ìƒì´ ë°œìƒí–ˆë‹¤.
- MobaXtermì„ í†µí•´ í†°ìº£ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ë‹ˆ
`Handshake failed due to invalid Upgrade header: null` ì™€ ê°™ì€ ë¬¸ì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.
<img width="595" alt="ec2_websocket ì—ëŸ¬" src="https://github.com/pickylemon/2024-portfolio-2nd/assets/156510800/1c406217-72ee-48d1-ac98-98052bc5a16e">

#### [í•´ê²°]
- ì›¹ì†Œì¼“ ì—°ê²°ì€ HTTP handshakeì‹œ websocketìœ¼ë¡œ Upgrade ìš”ì²­ì„ ë³´ëƒ„ìœ¼ë¡œì¨ ì´ë£¨ì–´ì§„ë‹¤. í•˜ì§€ë§Œ ë‚´ê°€ ì„¤ì •í•œ ì›ê²© í™˜ê²½ì—ì„œëŠ” í—¤ë”ì— upgradeì— ëŒ€í•œ ìœ íš¨í•œ ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸ì— websocket ì—°ê²°ì´ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì´ì—ˆë‹¤.
- í˜„ì¬, AWS EC2ë¥¼ ì›ê²© ì„œë²„ë¡œ ì´ìš©í•˜ê³  Nginxë¥¼ í†µí•´ reverse proxyë¥¼ êµ¬ì„±í•´ WebServerë¡œ ì—°ê²°ë  ìˆ˜ ìˆê²Œ ì›ê²© í™˜ê²½ì„ ì„¸íŒ…í•´ë‘” ìƒí™©ì´ì—ˆë‹¤.
- Nginx ê³µì‹ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í•˜ì˜€ë”ë‹ˆ (https://nginx.org/en/docs/http/websocket.html)
ë¬¸ì œì˜ ì›ì¸ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.
<img width="722" alt="nginxWebServerí•´ê²°2" src="https://github.com/pickylemon/2024-portfolio-2nd/assets/156510800/d4f30ba8-16b4-4aac-b8a0-33dd6449e237">  

- ì¦‰, upgrade í—¤ë”ëŠ” proxy serverë¡œ ì „ë‹¬ë˜ì§€ ì•Šìœ¼ë‹ˆ í”„ë¡ì‹œ ì„¤ì •ì— ì§ì ‘ upgrade ê´€ë ¨ëœ í—¤ë”ë¥¼ ëª…ì‹œí•´ì¤Œìœ¼ë¡œì¨ í•´ê²°ì´ ê°€ëŠ¥í–ˆë‹¤.
- ì•„ë˜ì™€ ê°™ì´ í”„ë¡ì‹œë¥¼ ì„¤ì •í•œ pf.conf íŒŒì¼ì— ì§ì ‘ upgrade ê´€ë ¨ í—¤ë”ë¥¼ ëª…ì‹œí•´ì£¼ì—ˆë”ë‹ˆ
ì›ê²© í™˜ê²½ì—ì„œë„ ë¡œì»¬ì—ì„œì™€ ê°™ì´ WebSocketì—°ê²°ì´ ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ì§ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.  
<img width="487" alt="pf conf" src="https://github.com/pickylemon/2024-portfolio-2nd/assets/156510800/5077d42e-59e1-499e-91da-f10de383b6ac">  

**>>>> ğŸ’¡ [EC2 í™˜ê²½ì—ì„œ WebSocket Connection Error í•´ê²°(ë¸”ë¡œê·¸ ì •ë¦¬)](http://velog.io/@melodie104/EC2-í™˜ê²½ì—ì„œ-WebSocket-Connection-Error-í•´ê²°)**
